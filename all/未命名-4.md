```mermaid
flowchart LR
    subgraph 第一阶段：客户验证
        A[开始] --> B[输入会员ID<br>（可选）]
        B --> C{会员ID是否输入？}
        C -->|是| D{ID是否有效？}
        D -->|无效| E[提示会员无效] --> Z[结束]
        C -->|否| F
        D -->|有效| F
    end
    
    F[进入购物流程] --> G
    
    subgraph 第二阶段：商品选购
        direction TB
        G[添加图书商品] --> H[输入图书ID+数量]
        H --> I{库存充足？}
        I -->|否| J[提示库存不足] --> Z
        I -->|是| K[计算小计加入订单]
        K --> L{继续添加？}
        L -->|是| H
        L -->|否| M
    end
    
    M[确认订单] --> N
    
    subgraph 第三阶段：订单完成
        direction TB
        N{支付方式选择} --> O[生成订单保存]
        O --> P{是否为会员？}
        P -->|是| Q[更新会员积分] --> R
        P -->|否| R[打印销售凭证]
        R --> Z
    end
```